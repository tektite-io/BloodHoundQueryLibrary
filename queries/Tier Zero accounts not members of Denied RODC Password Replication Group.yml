name: Tier Zero accounts not members of Denied RODC Password Replication Group
guid: e9613406-e346-410b-a033-690a6cf0c708
prebuilt: false
platforms: Active Directory
category: Active Directory Hygiene
description: 
query: |-
  // Get all Tier Zero accounts that are members of Denied RODC Password Replication Group
  MATCH (n:Base)-[:MemberOf*1..]->(m:Group)
  WHERE ((n:Tag_Tier_Zero) OR COALESCE(n.system_tags, '') CONTAINS 'admin_tier_0')
  AND (n:User OR n:Computer)
  AND m.objectid ENDS WITH '-519'
  WITH COLLECT(n.objectid) AS MembersOfDeniedGroup

  // Get all Tier Zero accounts
  MATCH (x:Base)
  WHERE ((x:Tag_Tier_Zero) OR COALESCE(x.system_tags, '') CONTAINS 'admin_tier_0')
  AND (x:User OR x:Computer)
  
  // Filter the members of Denied RODC Password Replication Group
  AND NOT x.objectid IN MembersOfDeniedGroup
  RETURN x
revision: 2
resources: 
acknowledgements: Martin Sohn Christensen, @martinsohndk

