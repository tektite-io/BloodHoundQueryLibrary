name: Computers with non-default Primary Group membership
guid: 5862dc4e-6f6f-4321-9474-d838968495ed
prebuilt: false
platforms: Active Directory
category: Active Directory Hygiene
description: 
query: |-
  MATCH p=(n:Computer)-[r:MemberOf]->(g:Group)
  WHERE NOT g.objectid ENDS WITH "-515" // Domain Computers
  AND NOT n.isdc = true
  AND NOT n.isreadonlydc = true
  AND r.isprimarygroup = true
  RETURN p
revision: 2
resources: 
- https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-ada3/e12954a4-6865-4432-94e6-00c310ca87c0
- https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/5dbcf875-e802-4357-a6e2-1bdff19ff9b5
- https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/73d11ea7-e634-453e-944d-559654cc91c5
acknowledgements: Martin Sohn Christensen, @martinsohndk
